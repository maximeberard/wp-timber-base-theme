{"version":3,"sources":["abstract-page.js"],"names":["AbstractPage","router","$cont","context","type","isHome","id","lazyload","getAttribute","ready","name","length","onResizeDebounce","onResize","bind","debug","init","initEvents","$link","find","not","bindedLinkClick","onLinkClick","externalLinkTarget","baseUrl","options","lazyloadEnabled","setTimeout","beforeLazyload","elements_selector","lazyloadClass","data_src","lazyloadSrcAttr","replace","data_srcset","lazyloadSrcSetAttr","callback_set","onLazyImageSet","callback_load","onLazyImageLoad","callback_processed","onLazyImageProcessed","blocks","$blocks","pageBlockClass","blockLength","initBlocks","ajaxEnabled","initAjax","pushFirstState","destroy","remove","destroyEvents","blockIndex","waitForImages","finished","onLoad","waitForAll","on","$window","off","e","loadDate","Date","loadDuration","loadBeginDate","nav","update","delay","minLoadDuration","onShowEnded","showEnded","loader","hide","show","document","body","formerPages","formerPage","formerPageDestroy","pop","onShow","TweenLite","to","opacity","onComplete","transition","removeClass","pageClass","onHidden","addClass","objectTypeAttr","block","classFactory","getBlockInstance","eq","push","i","onPageReady","getBlockById","getBlockIndexById","getFirstBlockByType","getFirstBlockIndexByType","element","index","$links","linksLength","abstractBaseUrl","split","linkIndex","link","linkString","indexOf","charAt","target"],"mappings":"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","file":"abstract-page.js","sourcesContent":["/**\n * Copyright Â© 2016, Ambroise Maupate\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is furnished\n * to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * @file abstract-page.js\n * @author Ambroise Maupate\n */\nimport log from \"loglevel\";\nimport TweenMax from \"TweenMax\";\nimport waitForImages from \"waitForImages\";\nimport $ from \"jquery\";\nimport Lazyload from 'Lazyload';\nimport {debounce} from \"utils/debounce\";\n\n/**\n * Base class for creating page implementations.\n *\n * **Do not instanciate this class directly, create a sub-class**.\n */\nexport class AbstractPage {\n    /**\n     * Base constructor for Pages.\n     *\n     * Do not override this method, override `init` method instead.\n     *\n     * @param  {Router}  router\n     * @param  {jQuery}  $cont\n     * @param  {String}  context\n     * @param  {String}  type\n     * @param  {Boolean} isHome\n     */\n    constructor(router, $cont, context, type, isHome) {\n        type = type || 'page';\n\n        if (!$cont) {\n            throw \"AbstractPage need a $cont (JQuery) to be defined.\";\n        }\n        if (!router) {\n            throw \"AbstractPage need a Router instance to be defined.\";\n        }\n        /**\n         *\n         * @type {Router}\n         */\n        this.router = router;\n        /**\n         *\n         * @type {jQuery}\n         */\n        this.$cont = $cont;\n        /**\n         * @type {String}\n         */\n        this.id = $cont[0].id;\n        /**\n         * @type {String}\n         */\n        this.context = context;\n        /**\n         * @type {String}\n         */\n        this.type = type;\n        /**\n         * @type {Boolean}\n         */\n        this.isHome = isHome;\n        /**\n         * @type {Lazyload}\n         */\n        this.lazyload = null;\n\n        if(this.$cont[0].getAttribute('data-is-home') == '1'){\n            this.isHome = true;\n        }\n\n        this.ready = false;\n\n        this.name = (this.$cont.length) ? this.$cont[0].getAttribute('data-node-name') : '';\n\n        this.onResizeDebounce = debounce(this.onResize.bind(this), 50, false);\n\n        log.debug('â³ï¸ #' + this.id + '\\t' + type);\n\n        this.init();\n        this.initEvents();\n    }\n\n    /**\n     * Initialize page.\n     *\n     * You should always extends this method in your child implementations instead\n     * of extending page constructor.\n     */\n    init() {\n        this.$link = this.$cont.find('a').not('[target=\"_blank\"]');\n        this.bindedLinkClick = this.router.onLinkClick.bind(this.router);\n\n        // Add target blank on external link\n        if(this.$link.length){\n            this.externalLinkTarget(this.$link, this.router.baseUrl);\n            this.$link = this.$cont.find('a').not('[target=\"_blank\"]');\n        }\n\n        // --- Lazyload --- //\n        if (this.router.options.lazyloadEnabled) {\n            setTimeout(() => {\n                this.beforeLazyload();\n                this.lazyload = new Lazyload({\n                    elements_selector: '.'+this.router.options.lazyloadClass,\n                    data_src: this.router.options.lazyloadSrcAttr.replace('data-', ''),\n                    data_srcset: this.router.options.lazyloadSrcSetAttr.replace('data-', ''),\n                    callback_set: this.onLazyImageSet.bind(this),\n                    callback_load: this.onLazyImageLoad.bind(this),\n                    callback_processed: this.onLazyImageProcessed.bind(this)\n                });\n            }, 0);\n        }\n\n        // --- Blocks --- //\n        this.blocks = [];\n        this.$blocks = this.$cont.find(this.router.options.pageBlockClass);\n        this.blockLength = this.$blocks.length;\n        if(this.blockLength) {\n            this.initBlocks();\n        }\n\n        // --- Context --- //\n        if (this.router.options.ajaxEnabled) {\n            if(this.context == 'ajax'){\n                this.initAjax();\n            } else {\n                this.router.pushFirstState(this.isHome, this.type, this.name);\n            }\n        }\n    }\n\n    /**\n     * Destroy current page and all its blocks.\n     */\n    destroy() {\n        log.debug('ð #' + this.id);\n        this.$cont.remove();\n        this.destroyEvents();\n        // --- Blocks --- //\n        if (this.blocks !== null) {\n            for (var blockIndex in this.blocks) {\n                this.blocks[blockIndex].destroy();\n            }\n        }\n        /*\n         * Remove Lazyload instance and listeners\n         */\n        if (null !== this.lazyload) {\n            this.lazyload.destroy();\n        }\n    }\n\n    /**\n     * Initialize basic events.\n     *\n     * Such as waitForImages and link click if you enabled Ajax navigation.\n     */\n    initEvents() {\n        if (this.$cont.find('img').length) {\n            this.$cont.waitForImages({\n                finished: this.onLoad.bind(this),\n                waitForAll: true\n            });\n        } else {\n            this.onLoad();\n        }\n\n        if(this.$link.length && this.router.options.ajaxEnabled) {\n            this.$link.on('click', this.bindedLinkClick);\n        }\n\n        this.router.$window.on('resize', this.onResizeDebounce);\n    }\n\n    /**\n     *\n     */\n    destroyEvents() {\n        this.$link.off('click', this.bindedLinkClick);\n        this.router.$window.off('resize', this.onResizeDebounce);\n    }\n\n    /**\n     * @param e\n     * @private\n     */\n    onLoad(e) {\n        this.loadDate = new Date();\n        this.loadDuration = this.loadDate - this.router.loadBeginDate;\n        this.router.nav.update(this);\n\n        const delay = (this.loadDuration > this.router.options.minLoadDuration) ? 0 : this.router.options.minLoadDuration - this.loadDuration;\n\n        // Hide loading\n        setTimeout(() => {\n            const onShowEnded = this.showEnded.bind(this);\n\n            this.ready = true;\n            this.router.loader.hide();\n\n            if(this.context == 'static'){\n                this.show(onShowEnded);\n            } else if(this.context == 'ajax'){\n                // Update body id\n                if(this.name !== '') document.body.id = this.name;\n                // Hide formerPages - show\n                if (this.router.formerPages.length > 0) {\n                    const formerPage = this.router.formerPages[(this.router.formerPages.length - 1)];\n                    const formerPageDestroy = formerPage.destroy.bind(formerPage);\n\n                    /*\n                     * Very important,\n                     * DO NOT animate if there are more than 1 page\n                     * in destroy queue!\n                     */\n                    if (this.router.formerPages.length > 1) {\n                        formerPageDestroy();\n                    } else {\n                        formerPage.hide(formerPageDestroy);\n                    }\n                    this.router.formerPages.pop();\n                }\n\n                this.show(onShowEnded);\n            }\n        }, delay);\n    }\n\n    /**\n     * @param {Function} onShow\n     */\n    show(onShow) {\n        log.debug('â¶ï¸ #' + this.id);\n\n        // Animate\n        TweenLite.to(this.$cont, 0.6, {opacity:1, onComplete: () => {\n            if (typeof onShow !== 'undefined') onShow();\n        }});\n    }\n\n    /**\n     *\n     */\n    showEnded() {\n        this.router.transition = false;\n        this.$cont.removeClass(this.router.options.pageClass + '-ajax');\n        this.$cont.removeClass(this.router.options.pageClass + '-transitioning');\n    }\n\n    /**\n     * @param {Function} onHidden\n     */\n    hide(onHidden) {\n        log.debug('âï¸ #' + this.id);\n\n        TweenLite.to(this.$cont, 0.6, {opacity:0, onComplete: () => {\n            if (typeof onHidden !== 'undefined') onHidden();\n        }});\n    }\n\n    initAjax() {\n        this.$cont.addClass(this.router.options.pageClass + '-transitioning');\n    }\n\n    /**\n     * @private\n     */\n    initBlocks() {\n        for(let blockIndex = 0; blockIndex < this.blockLength; blockIndex++) {\n            let type = this.$blocks[blockIndex].getAttribute(this.router.options.objectTypeAttr),\n                id = this.$blocks[blockIndex].id;\n\n            let block = this.router.classFactory.getBlockInstance(type, this, this.$blocks.eq(blockIndex));\n            /*\n             * Prevent undefined blocks to be appended to block collection.\n             */\n            if (block) {\n                this.blocks.push(block);\n            }\n        }\n        /*\n         * Notify all blocks that page init is over.\n         */\n        for (let i = this.blocks.length - 1; i >= 0; i--) {\n            if(typeof this.blocks[i].onPageReady == 'function') this.blocks[i].onPageReady();\n        }\n    }\n\n    /**\n     * Get a page block instance from its `id`.\n     *\n     * @param  {String} id\n     * @return {AbstractBlock|null}\n     */\n    getBlockById(id) {\n        for (let i in this.blocks) {\n            if (this.blocks[i] &&\n                this.blocks[i].id &&\n                this.blocks[i].id == id) {\n                return this.blocks[i];\n            }\n        }\n        return null;\n    }\n    \n    /**\n     * Get a page block index from its `id`.\n     *\n     * @param  {String} id\n     * @return {AbstractBlock|null}\n     */\n    getBlockIndexById(id) {\n        for (let i in this.blocks) {\n            if (this.blocks[i] &&\n                this.blocks[i].id &&\n                this.blocks[i].id == id) {\n                return i;\n            }\n        }\n        return null;\n    }\n    \n    /**\n     * Get the first page block instance from its `type`.\n     *\n     * @param  {String} type\n     * @return {AbstractBlock|null}\n     */\n    getFirstBlockByType(type){\n        for (let i in this.blocks) {\n            if (this.blocks[i] &&\n                this.blocks[i].type &&\n                this.blocks[i].type == type) {\n                return this.blocks[i];\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Get the first page block index from its `type`.\n     *\n     * @param  {String} type\n     * @return {AbstractBlock|null}\n     */\n    getFirstBlockIndexByType(type){\n        for (let i in this.blocks) {\n            if (this.blocks[i] &&\n                this.blocks[i].type &&\n                this.blocks[i].type == type) {\n                return i;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * @abstract\n     */\n    onResize(){\n\n    }\n\n    /**\n     * Called before init lazyload images.\n     *\n     * @abstract\n     */\n    beforeLazyload() {\n\n    }\n\n    /**\n     * After image src switched.\n     *\n     * @abstract\n     * @param {HTMLImage} element\n     */\n    onLazyImageSet(element) {\n        log.debug('\\tð¼ Â«'+element.id+'Â» set');\n    }\n\n    /**\n     * After lazyload image loaded.\n     *\n     * @abstract\n     * @param {HTMLImage} element\n     */\n    onLazyImageLoad(element) {\n        log.debug('\\tð¼ Â«'+element.id+'Â» load');\n    }\n\n    /**\n     * Before lazyload.\n     *\n     * @abstract\n     */\n    onLazyImageProcessed(index) {\n        log.debug('\\tð¼ Lazy load processed');\n    }\n\n    /**\n     * Add target blank to external links.\n     *\n     * @param  {JQuery} $links\n     * @param  {String} baseUrl\n     */\n    externalLinkTarget($links, baseUrl) {\n        const linksLength = $links.length;\n        let abstractBaseUrl = baseUrl.split('://');\n\n        abstractBaseUrl = abstractBaseUrl[1];\n\n        for(let linkIndex = 0; linkIndex < linksLength; linkIndex++){\n            const link = $links[linkIndex];\n            /*\n             * Use RAW href data not to automatically\n             * get protocol and domain in string\n             */\n            const linkString = link.getAttribute('href');\n            if(linkString.indexOf(abstractBaseUrl) == -1 &&\n               linkString.indexOf('javascript') == -1 &&\n               linkString.indexOf('mailto:') == -1 &&\n               linkString.charAt(0) != '/' &&\n               linkString.charAt(0) != '#')\n            {\n                $links[linkIndex].target = '_blank';\n            }\n        }\n    }\n}\n"]}